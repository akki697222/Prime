---@type module_manifest
local manifest = {
    name = "tty",
    version = "0.1.0",
    path = "kernel/drivers/tty.ko"
}
local tty_devices = {}
---@class tty_handler
local tty_class = {
    ---@alias tty_mode 
    ---| '"key"' # Handles Key (Returns Keycode)
    ---| '"char"' # Handles Char
    ---| '"raw"' # Raw input
    
    ---@type tty_mode
    mode = "char",
    buffer = {},
    handles = {
        char = function (char, self)
            if self.isReading then
                table.insert(self.buffer, char)
            end
        end,
        key = function (keycode, self)
            if self.isReading then
                table.insert(self.buffer, keycode)
            end
        end,
        raw = function (keycode, self)
            table.insert(self.buffer, keycode)
        end
    },
    isReading = false,
    ---@param self tty_handler
    read = function (self)
        if self.mode ~= "raw" then
            self.isReading = true
        else
            return self.buffer[1]
        end
        while self.isReading do
            
        end
    end
}
local function init()
    ---@type eventsystem
    local eventsystem = require("system.event")
    local tty_input = function (event)
        if event[1] == "key" then
            
        elseif event[1] == "char" then
            
        end
    end
end
local tty = {}

return tty, init, manifest